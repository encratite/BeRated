@using BeRated.App
@using BeRated.Common
@using BeRated.Model
@using System.Collections.Generic

@model Game

@{
    Layout = "/Layout";
    ViewBag.Title = string.Format("Game {0}", Model.Id);
}

@helper TeamTable(string playerDescription, string className, List<PlayerGameInfo> team)
{
    <table class="sortable grid numericTable teamPlayers @className">
        <tr>
            <th data-column-type="string">@playerDescription</th>
            <th>Kills</th>
            <th>Deaths</th>
            <th>M-Rating</th>
            <th>K-Rating</th>
        </tr>
        @foreach (var player in team)
        {
            <tr>
                <td>@Helper.GetPlayerLink(player)</td>
                <td>@player.Kills</td>
                <td>@player.Deaths</td>
                <td>@Helper.GetRating(player.MatchRating)</td>
                <td>@Helper.GetRating(player.KillRating)</td>
            </tr>
        }
    </table>
}

<ul class="gameDescription">
    <li><b>Time:</b> @Model.Time</li>
    <li><b>Map:</b> @Model.Map</li>
    <li><b>Score:</b> @Helper.GetScore(Model)</li>
</ul>

<h1>Players</h1>
@TeamTable("Counter-Terrorist", "counterTerrorists", Model.CounterTerrorists)
<div class="matchup">
    <a href="/Matchup?team1=@Helper.GetPlayerIds(Model.CounterTerrorists)&team2=@Helper.GetPlayerIds(Model.Terrorists)">Analyze this matchup</a>
</div>
@TeamTable("Terrorist", "terrorists", Model.Terrorists)

<h1>Rounds</h1>
<table class="grid gameKills">
    <tr>
        <th>Kills</th>
        <th>Winner</th>
        <th>Score</th>
    </tr>
    @foreach (var round in Model.Rounds)
    {
        <tr>
            <td>
                <ul>
                    @foreach (var kill in round.Kills)
                    {
                        <li>@Helper.GetPlayerLink(kill.Killer, kill.KillerTeam == Team.Terrorist) killed @Helper.GetPlayerLink(kill.Victim, kill.KillerTeam != Team.Terrorist) with "@kill.Weapon"</li>
                    }
                </ul>
            </td>
            <td>@Helper.GetTeam(round.Winner)</td>
            <td>@Helper.GetScore(round.CounterTerroristScore, round.TerroristScore)</td>
        </tr>
    }
</table>